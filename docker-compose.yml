services:
  # Backend with host network (required for tmux access)
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    network_mode: host
    user: "${HOST_UID:-1000}:${HOST_GID:-1000}"
    environment:
      - MOBILEAGENT_HOST=0.0.0.0
      - MOBILEAGENT_PORT=8765
      - MOBILEAGENT_CORS_ORIGINS=["*"]
      - MOBILEAGENT_POLL_INTERVAL=0.1
      - MOBILEAGENT_DISCOVERY_INTERVAL=5.0
    volumes:
      # Mount host /tmp for tmux socket access
      - /tmp:/tmp
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8765/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Frontend static server with host network
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    network_mode: host
    environment:
      - PORT=5678
    restart: unless-stopped
